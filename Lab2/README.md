# 075: Computer Architecture - Assignment 2

Ανδρέας Γούλας (9061), Κωνσταντίνος Δουμανίδης (9263)

## Βήμα 1ο

### L1 Instruction Cache

Παράμετρος     |Τιμή
---------------|------
Μέγεθος        |32768B
Συσχέτιση      |2-way
Μέγεθος Γραμμής|64B

### L1 Data Cache

Παράμετρος     |Τιμή
---------------|------
Μέγεθος        |65536B
Συσχέτιση      |2-way
Μέγεθος Γραμμής|64B

### L2 Cache

Παράμετρος     |Τιμή
---------------|--------
Μέγεθος        |2097152B
Συσχέτιση      |8-way
Μέγεθος Γραμμής|64B

### 2GHz

Benchmark|Χρόνος   |CPI      |L1 DCache|L1 ICache|L2 Cache
---------|---------|---------|---------|---------|--------
bzip     |83.982ms |1.679650 |0.014798 |0.000077 |0.282163
mcf      |64.955ms |1.299095 |0.002108 |0.023612 |0.055046
hmmer    |59.396ms |1.187917 |0.001637 |0.000221 |0.077760
sjeng    |513.528ms|10.270554|0.121831 |0.000020 |0.999972
libm     |174.671ms|3.493415 |0.060972 |0.000094 |0.999944

### 1GHz

Benchmark|Χρόνος   |CPI     |L1 DCache|L1 ICache|L2 Cache
---------|---------|--------|---------|---------|--------
bzip     |161.025ms|1.610247|0.014675 |0.000077 |0.282157
mcf      |127.942ms|1.279422|0.002108 |0.023627 |0.055046
hmmer    |118.530ms|1.185304|0.001629 |0.000221 |0.077747
sjeng    |704.056ms|7.040561|0.121831 |0.000020 |0.999972
libm     |262.327ms|2.623265|0.060971 |0.000094 |0.999944

Το system χρονίζεται και στις δύο περιπτώσεις στα 1GHz (system.clk_domain). 
Αυτό το ρολόι χρησιμοποιείται για τον συγχρονισμό όλων των εξαρτημάτων πάνω
στην motherboard. Αντίθετα, το cpu_clk_domain αναφέρεται στο ρολόι του
επεξεργαστή, το οποίο είναι κατά κανόνα πολλαπλάσιο του system clock. Αν
προσθέσουμε επιπλέον επεξεργαστές, αυτοί θα χρονίζονται σε πολλαπλάσια του
system clock.

Παρατηρούμε ότι ο διπλασιασμός της συχνότητας του ρολογίου δεν έχει ως
αποτέλεσμα τον ακριβή υποδιπλασιασμό του χρόνο εκτέλεσης. Αυτό οφείλεται στο
γεγονός ότι μεγάλο μέρος του χρόνου εκτέλεσης δαπανάται σε προσβάσεις στην
μνήμη. Η επιτάχυνση είναι μικρότερη όταν έχουμε υψηλό miss rate.

### Graphs
![Execution Time](/Lab2/img/step1_exec_time.png)
![CPI](/Lab2/img/step1_CPI.png)
![D-Cache Miss Rate](/Lab2/img/step1_dcache.png)
![I-Cache Miss Rate](/Lab2/img/step1_icache.png)
![L2 Cache Miss Rate](/Lab2/img/step1_l2.png)

## Βήμα 2ο

* ### Μέγεθος Γραμμής

Benchmark|32B      |64B      |128B    |256B
---------|---------|---------|--------|--------
bzip     |1.852581 |1.67965  |1.666573|1.661958
mcf      |1.260085 |1.299095 |1.330534|1.298444
hmmer    |1.196843 |1.187917 |1.181978|1.179864
sjeng    |17.653706|10.270554|6.799471|5.175719
libm     |5.607827 |3.493415 |2.581299|1.990648

![Block Size](/Lab2/img/step2_block_size.png)

Παρατηρούμε ότι το CPI εμφανίζει γενικά μια ισχυρή συσχέτιση με το μέγεθος
γραμμής της κρυφής μνήμης, ειδικά στα sjeng και libm. To mcf δεν εμφάνισε κάποια
βελτίωση με την αύξηση της παραμέτρου.

TODO: Rewrite the following

* ### libm & sjeng

Το πρώτο πρόβλημα που εντοπίσαμε είναι το υψηλό miss rate της L2 cache στα libm
και sjeng. Δοκιμάσαμε να μεταβάλλουμε το μέγεθος και το associativity της L2,
όμως δεν παρατηρήσαμε αλλαγή στο miss rate. To CPI βελτιώθηκε ελάχιστα με την
αύξηση του μεγέθους της L2. H αύξηση του associativity πέρα απο 8-way δεν
επηρέασε καθόλου την απόδοση.

#### libm
![CPI](/Lab2/img/step2_libm_l2.png)

#### sjeng
![CPI](/Lab2/img/step2_sjeng_l2.png)

Στη συνέχεια, δοκιμάσαμε να μεταβάλλλουμε το μέγεθος γραμμής. Παρατηρήσαμε ότι
αυτή η μεταβολή επηρέασε σημαντικά το CPI των παραπάνω benchmark καθώς και το
miss rate της D-Cache.

#### libm
![CPI](/Lab2/img/step2_libm_blocksize.png)

#### sjeng
![CPI](/Lab2/img/step2_sjeng_blocksize.png)

![D-Cache Miss Rate](/Lab2/img/step2_libm_sjeng_dcache.png)

* ### mcf

Για να βελτιώσουμε την απόδοση του mcf δοκιμάσαμε να μεταβάλλουμε τα
χαρακτηρηστικά της L1 I-Cache. Η αύξηση του associativity σε 4-way καθώς και η
αύξηση του μεγέθους της σε 64KB επέφεραν σημαντίκη βελτίωση στο miss rate της
I-Cache και μια βελτίωση κατά 0.15 στο CPI.

Αυτό οφείλεται στο γεγονός ότι το benchmark περιέχει έναν βρόγχο επανάληψης
ο οποίος δε χωράει ολόκληρος στην default L1 I-Cache.

![MCF IC](/Lab2/img/step2_mcf_ic.png)

* ### bzip

H bzip είχε εξ αρχής καλή απόδοση όσον αφορά το CPI στις default ρυθμίσεις του
συστήματος που εξομοιώνουμε. Παρατηρήσαμε ότι ένα πιθανό σημείο όπου θα μπορούσε
να γίνει βελτίωση ήταν το miss rate στην L2 και D-Cache. Μέσα από τις δοκιμές
μας για διάφορες ρυθμίσεις για την D-Cache δεν βρήκαμε κάποια αξιοσημείωτη
βελτίωση. Επίσης ο πειραματισμός μας με διαφορετικά cache line sizes και L2
configurations ενώ έφερε κάποιες μικρές βελτιώσεις στο L2 cache miss rate, δεν
έφερε κάποια ιδιαίτερη βελτίωση στο συνολικό CPI.

![L2 Miss Rate](/Lab2/img/step2_bzip_l2.png)
![D-Cache Miss Rate](/Lab2/img/step2_bzip_dcache.png)

* ### hmmer

Δοκιμάσαμε να μεταβάλλουμε τις παραμέτρους της L1 (D-Cache/I-Cache), της L2
καθώς και το μέγεθος γραμμής. Βελτίωση είδαμε μόνο στον πειραματισμό μας με τις
ρυθμίσεις της L1 όπου είδαμε βελτίωση με περισσότερο associativity όπως και με
την αύξηση του μεγέθους.

![L2 - D-Cache Miss Rate](/Lab2/img/step2_hmmer_dcache.png)
![I-Cache Miss Rate](/Lab2/img/step2_hmmer_icache.png) 

### Βέλτιστες Ρυθμίσεις

* libm, sjeng

Παράμετρος      |Τιμή
----------------|------
L2 Μέγεθος      |4MB
L2 Associativity|16-way
Μέγεθος Γραμμής |256B

* mcf

Παράμετρος           |Τιμή
---------------------|-----
I-Cache Μέγεθος      |64KB
I-Cache Associativity|2-way

* bzip

Παράμετρος           |Τιμή
---------------------|-----
D-Cache Μέγεθος      |128KB
D-Cache Associativity|4-way
L2 Μέγεθος           |4MB
L2 Associativity     |8-way

* hmmer

Παράμετρος           |Τιμή
---------------------|-----
I-Cache Μέγεθος      |64KB
I-Cache Associativity|2-way
D-Cache Μέγεθος      |64KB
D-Cache Associativity|2-way
